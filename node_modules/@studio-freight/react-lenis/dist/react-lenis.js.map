{"version":3,"file":"react-lenis.js","sources":["../src/index.jsx"],"sourcesContent":["'use client'\n\nimport { useFrame } from '@studio-freight/hamo'\nimport Lenis from '@studio-freight/lenis'\nimport PropTypes from 'prop-types' // ES6\nimport React, {\n  createContext,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n  useState,\n} from 'react'\nimport { create } from 'zustand'\nimport cn from 'clsx'\n\nexport const LenisContext = createContext()\n\nconst useRoot = create(() => ({}))\n\nfunction useCurrentLenis() {\n  const local = useContext(LenisContext)\n  const root = useRoot()\n\n  return local ?? root\n}\n\n/**\n * @param {CallbackFunction} [callback] Callback to be called on scroll\n * @param {Array=} [deps=[]] Dependencies for callback\n * @param {number=} [priority=0] Priority of callback (lower priority callbacks are called first)\n *\n * @returns {LenisInstance} Lenis instance\n */\nexport function useLenis(callback, deps = [], priority = 0) {\n  const { lenis, addCallback, removeCallback } = useCurrentLenis()\n\n  useEffect(() => {\n    if (!callback || !addCallback || !removeCallback || !lenis) return\n\n    addCallback(callback, priority)\n    callback(lenis)\n\n    return () => {\n      removeCallback(callback)\n    }\n  }, [lenis, addCallback, removeCallback, priority, ...deps])\n\n  return lenis\n}\n\n/**\n * @param {boolean=} [root] Whether Lenis will be initialized on document.documentElement\n * @param {ReactLenisOptions} [options={}] Lenis options {@link ReactLenisOptions}\n * @param {boolean=} [autoRaf=true] Whether to call Lenis.raf automatically on every frame\n * @param {number=} [rafPriority=0] Priority of Lenis.raf call (lower priority callbacks are called first)\n * @param {string=} [className] Class name to be applied to the wrapper\n */\nconst ReactLenis = forwardRef(\n  ({ children, root = false, options = {}, autoRaf = true, rafPriority = 0, className, ...props }, ref) => {\n    const wrapperRef = useRef()\n    const contentRef = useRef()\n\n    const [lenis, setLenis] = useState()\n\n    const callbacks = useRef([])\n\n    const addCallback = useCallback((callback, priority) => {\n      callbacks.current.push({ callback, priority })\n      callbacks.current.sort((a, b) => a.priority - b.priority)\n    }, [])\n\n    const removeCallback = useCallback((callback) => {\n      callbacks.current = callbacks.current.filter((cb) => cb.callback !== callback)\n    }, [])\n\n    useImperativeHandle(ref, () => lenis, [lenis])\n\n    useEffect(() => {\n      const lenis = new Lenis({\n        ...options,\n        ...(!root && {\n          wrapper: wrapperRef.current,\n          content: contentRef.current,\n        }),\n      })\n\n      setLenis(lenis)\n\n      return () => {\n        lenis.destroy()\n        setLenis(undefined)\n      }\n    }, [root, JSON.stringify(options)])\n\n    useFrame((time) => {\n      if (autoRaf) {\n        lenis?.raf(time)\n      }\n    }, rafPriority)\n\n    useEffect(() => {\n      if (root && lenis) {\n        useRoot.setState({ lenis, addCallback, removeCallback })\n      }\n    }, [root, lenis, addCallback, removeCallback])\n\n    const onScroll = useCallback((e) => {\n      for (let i = 0; i < callbacks.current.length; i++) {\n        callbacks.current[i].callback(e)\n      }\n    }, [])\n\n    useEffect(() => {\n      lenis?.on('scroll', onScroll)\n\n      return () => {\n        lenis?.off('scroll', onScroll)\n      }\n    }, [lenis, onScroll])\n\n    const onClassNameChange = useCallback(() => {\n      if (wrapperRef.current) wrapperRef.current.className = cn(lenis?.className, className)\n    }, [lenis, className])\n\n    useEffect(() => {\n      onClassNameChange()\n\n      lenis?.on('className change', onClassNameChange)\n\n      return () => {\n        lenis?.off('className change', onClassNameChange)\n      }\n    }, [lenis, onClassNameChange])\n\n    return (\n      <LenisContext.Provider value={{ lenis, addCallback, removeCallback }}>\n        {root ? (\n          children\n        ) : (\n          <div ref={wrapperRef} className={cn(lenis?.className, className)} {...props}>\n            <div ref={contentRef}>{children}</div>\n          </div>\n        )}\n      </LenisContext.Provider>\n    )\n  },\n)\nReactLenis.displayName = 'ReactLenis'\n\nReactLenis.propTypes = {\n  children: PropTypes.node,\n  root: PropTypes.bool,\n  options: PropTypes.object,\n  autoRaf: PropTypes.bool,\n  rafPriority: PropTypes.number,\n  className: PropTypes.string,\n}\n\nexport { ReactLenis, ReactLenis as Lenis }\n\n/**\n * @callback EasingFunction\n * @param {number} rawValue\n * @returns {number} eased output value\n */\n\n/**\n * @callback CallbackFunction\n * @param {LenisInstance} instance\n */\n\n/**\n * @typedef {Object} CallbackEvents\n * @property {CallbackFunction[]} scroll scroll events\n */\n\n/**\n * @callback RAF\n * @param {number} time\n */\n\n/**\n * @typedef {Object} ScrollToParams\n * @property {number} [offset] equivalent to scroll-padding-top\n * @property {number} [lerp] animation interpolation rate\n * @property {number} [duration] animation duration (in seconds)\n * @property {EasingFunction} [easing] animation easing\n * @property {boolean} [immediate] ignore duration, easing and lerp\n * @property {boolean} [lock] whether or not to prevent the user from scrolling until the target is reached\n * @property {boolean} [force] reach target even if instance is stopped\n * @property {CallbackFunction} [onComplete] called when the target is reached\n */\n\n/**\n * @callback ScrollTo\n * @param {number|string|HTMLElement} target\n * @param {ScrollToParams} [options]\n */\n\n/**\n * @typedef {Object} ReactLenisOptions\n * @property {(HTMLElement|Window)} [wrapper=window] interpolation rate\n * @property {HTMLElement=} [content=document.documentElement]\n * @property {(HTMLElement|Window)} [wheelEventsTarget=wrapper]\n * @property {number=} [lerp=0.1] interpolation rate\n * @property {number=} [duration=1.2] scroll duration\n * @property {EasingFunction=} [easing=(t) => Math.min(1, 1.001 - Math.pow(2, -10 * t))] // easing function to apply to scroll values\n * @property {string=} [orientation='vertical'] scroll orientation\n * @property {string=} [gestureOrientation='vertical']\n * @property {boolean=} [smoothWheel=true]\n * @property {boolean=} [smoothTouch=false]\n * @property {boolean=} [syncTouch=false]\n * @property {number=} [syncTouchLerp=0.1]\n * @property {number=} [touchInertiaMultiplier=1]\n * @property {boolean=} [normalizeWheel=false]\n * @property {boolean=} [infinite=false] enable infinite scroll\n * @property {boolean=} [autoResize=true]\n */\n\n/**\n * @typedef {Object} Dimensions\n * @property {(HTMLElement|Window)} wrapper Wrapper lenis is applied to\n * @property {HTMLElement} content\n * @property {ResizeObserver} contentResizeObserver\n * @property {function():void} resize\n * @property {function():void} onContentResize\n * @property {function():void} onWrapperResize\n * @property {number} width viewport width\n * @property {number} height viewport height\n * @property {number} scrollWidth\n * @property {number} scrollHeight\n */\n\n/**\n * @typedef {Object} Emitter\n * @property {CallbackEvents} events\n */\n\n/**\n * @callback EventHandler\n * @param {string} id lenis instance event\n * @param {CallbackFunction} fn callback\n */\n\n/**\n * @typedef {Object} LenisInstance\n * @property {number} animatedScroll Current scroll value\n * @property {Dimensions} dimensions Dimensions instance\n * @property {number} direction scroll direction; 0: stopped, 1: scrolling up, -1: scrolling down\n * @property {Emitter} emitter Emitter instance\n * @property {ReactLenisOptions} options Instance options {@link ReactLenisOptions}\n * @property {number} targetScroll Target scroll value\n * @property {number} time Time elapsed since instance creation\n * @property {number} actualScroll Current scroll value registered by the browser\n * @property {number} velocity Current scroll velocity\n * @property {boolean} isHorizontal Whether or not the instance is horizontal\n * @property {boolean} isScrolling Whether or not the instance is being animated\n * @property {boolean} isSmooth Whether or not the instance is animated\n * @property {boolean} isStopped Whether or not the user should be able to scroll\n * @property {number} limit Maximum scroll value\n * @property {number} progress Scroll progress from 0 to 1\n * @property {HTMLElement} rootElement Element on which Lenis is instanced\n * @property {number} scroll Current scroll value (handles infinite scroll if activated)\n * @property {function():void} stop Pauses the scroll\n * @property {function():void} start Resumes the scroll\n * @property {function():void} resize Compute internal sizes, has to be used if autoResize option is false\n * @property {function():void} destroy Destroys the instance and removes all events\n * @property {EventHandler} on Lenis event listener\n * @property {ScrollTo} scrollTo Scroll to target\n * @property {RAF} raf Must be called every frame for internal usage\n */\n"],"names":["_excluded","LenisContext","createContext","useRoot","create","ReactLenis","forwardRef","_ref","ref","children","_ref$root","root","_ref$options","options","_ref$autoRaf","autoRaf","_ref$rafPriority","rafPriority","className","props","_objectWithoutPropertiesLoose","wrapperRef","useRef","contentRef","_useState","useState","lenis","setLenis","callbacks","addCallback","useCallback","callback","priority","current","push","sort","a","b","removeCallback","filter","cb","useImperativeHandle","useEffect","Lenis","_extends","wrapper","content","destroy","undefined","JSON","stringify","useFrame","time","raf","setState","onScroll","e","i","length","on","off","onClassNameChange","cn","React","createElement","Provider","value","displayName","propTypes","PropTypes","node","bool","object","number","string","deps","local","_useCurrentLenis","useContext","concat"],"mappings":"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"}